define ("scormreport_heatmap/report_view",["exports","core/notification","core/templates"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=function(a){return a&&a.__esModule?a:{default:a}}(c);function d(a){return g(a)||f(a)||j(a)||e()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function g(a){if(Array.isArray(a))return k(a)}function h(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=j(a))||b&&a&&"number"==typeof a.length){if(c)a=c;var d=0,e=function(){};return{s:e,n:function n(){if(d>=a.length)return{done:!0};return{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=!0,g=!1,h;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();f=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!f&&null!=c.return)c.return()}finally{if(g)throw h}}}}function j(a,b){if(!a)return;if("string"==typeof a)return k(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return k(a,b)}function k(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}var l=function(a){var b={},c=function(c){b[c]={};var d=a[c].questions,e=a[c].title,f={};Object.values(d).forEach(function(a){var b=a.id;try{var c=b.split("_")[0];if(!(c in f)){f[c]={data:[],id:c}}f[c].data.push(a)}catch(b){if(!("default"in f)){f["default"]={data:[],id:"default"}}f["default"].data.push(a)}});for(var p in f){var g=0,i=1,j=0,k=0,l=h(f[p].data),m;try{for(l.s();!(m=l.n()).done;){var n=m.value,o=n.correct_answers/n.total_answers;if(o>g){g=o}if(o<i){i=o}k+=n.total_answers;j+=o}}catch(a){l.e(a)}finally{l.f()}var q=j/f[p].data.length;f[p].statistics={answers:k,average:q}}b[c].groups=f;b[c].title=e};for(var d in a){c(d)}return b},m=function(a,d){var e="";if("description"in a){e=""===a.description.trim()?a.id:a.description}else{e=a.id}var f={lines:a.learner_responses,title:e,id:a.id,answers:a.total_answers};c.default.renderForPromise("scormreport_heatmap/unscored_default_table",f).then(function(a){var b=a.html,e=a.js;c.default.appendNodeContents(d,b,e);return!0}).catch(function(a){return(0,b.exception)(a)})},n=function(a,e){var f="";if("description"in a){f=""===a.description.trim()?a.id:a.description}else{f=a.id}var g={},j=h(a.learner_responses),k;try{for(j.s();!(k=j.n()).done;){var l=k.value,m=h(l),n;try{for(m.s();!(n=m.n()).done;){var w=n.value;w=parseFloat(w);if(!(w in g)){g[w]=0}g[w]=g[w]+1}}catch(a){m.e(a)}finally{m.f()}}}catch(a){j.e(a)}finally{j.f()}for(var o=Object.keys(g),p=Math.max.apply(Math,d(o)),q=Math.min.apply(Math,d(o)),r=[],s=[],t=q;t<=p;t++){r.push(t);s.push(t in o?g[t]:0)}var u=[{x:r,y:s,type:"bar"}],v={id:a.id,title:f,answers:a.total_answers};c.default.renderForPromise("scormreport_heatmap/plotlysection",v).then(function(b){var d=b.html,f=b.js;c.default.appendNodeContents(e,d,f);window.Plotly.newPlot("scormreport_heatmap_section_"+a.id,u);return!0}).catch(function(a){return(0,b.exception)(a)})},o=function(a,d){var e="";if("description"in a){e=""===a.description.trim()?a.id:a.description}else{e=a.id}var f={y0:" ",x:a.percentages,span:[0,1],spanmode:"manual",meanline:{visible:!0},points:"all",pointpos:0,box:{visible:!0},jitter:0,scalemode:"count",type:"violin",orientation:"h"},g={yaxis:{zeroline:!1},violinmode:"overlay"},h={id:a.id,title:e,answers:a.total_answers};c.default.renderForPromise("scormreport_heatmap/plotlysection",h).then(function(b){var e=b.html,h=b.js;c.default.appendNodeContents(d,e,h);window.Plotly.newPlot("scormreport_heatmap_section_"+a.id,[f],g);return!0}).catch(function(a){return(0,b.exception)(a)})},p=function(a,d){var e="";if("description"in a){e=""===a.description.trim()?a.id:a.description}else{e=a.id}var f=a.correct_answers,g=a.total_answers,h=Math.max(Math.min(100,Math.round(100*f/g)),0),i={id:a.id,title:e,answers:a.total_answers,percentage:h,correct:f,total:g};c.default.renderForPromise("scormreport_heatmap/plotlysection",i).then(function(a){var b=a.html,e=a.js;c.default.appendNodeContents(d,b,e);return!0}).catch(function(a){return(0,b.exception)(a)})},q=function(a,b){if("spectrum"===a.displaytype&&0<a.percentages.length){var c=a.percentages[0],d=1===c||0===c;if(d){var e=h(a.percentages),f;try{for(e.s();!(f=e.n()).done;){var i=f.value;if(c!==i){d=!1;break}}}catch(a){e.e(a)}finally{e.f()}}}var g="#".concat(b,"_hiddencontent");if("manual_scored"===a.displaytype&&!d){o(a,g)}else if("result_scored"===a.displaytype){p(a,g)}else if("numeric_unscored"===a.displaytype){n(a,g)}else if("default_unscored"===a.displaytype){m(a,g)}};a.init=function init(a){var d=l(a);if(1===Object.keys(d).length){d=d[Object.keys(d)[0]];var e=function(a){var e=d.groups[a],f="scormreport_heatmap_".concat(a),g={id_prefix:f,title:a,answers:e.statistics.answers,average:(100*e.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",g).then(function(a){var b=a.html,d=a.js;c.default.appendNodeContents("#scormreport_heatmap_container",b,d);var g=h(e.data),i;try{for(g.s();!(i=g.n()).done;){var j=i.value;q(j,f)}}catch(a){g.e(a)}finally{g.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var j in d.groups){e(j)}}else{for(var f=function(){var a=i[g],e=d[a],f={id_prefix:"scormreport_heatmap_scosection".concat(a),title:"".concat(e.title)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",f).then(function(d){var f=d.html,g=d.js;c.default.appendNodeContents("#scormreport_heatmap_container",f,g);var i=function(d){var f=e.groups[d],g="scormreport_heatmap_".concat(d),i={id_prefix:g,title:d,answers:f.statistics.answers,average:(100*f.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",i).then(function(b){var d=b.html,e=b.js;c.default.appendNodeContents("#scormreport_heatmap_scosection".concat(a,"_hiddencontent"),d,e);var i=h(f.data),j;try{for(i.s();!(j=i.n()).done;){var k=j.value;q(k,g)}}catch(a){i.e(a)}finally{i.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var j in e.groups){i(j)}}).catch(function(a){return(0,b.exception)(a)})},g=0,i=Object.keys(d);g<i.length;g++){f()}}}});
//# sourceMappingURL=report_view.min.js.map
