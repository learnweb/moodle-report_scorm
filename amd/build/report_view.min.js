define ("scormreport_heatmap/report_view",["exports","core/notification","core/templates","core/modal_factory","scormreport_heatmap/modal_passgrade"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.oneinallchart=a.init=void 0;c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=h(a))||b&&a&&"number"==typeof a.length){if(c)a=c;var d=0,e=function(){};return{s:e,n:function n(){if(d>=a.length)return{done:!0};return{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=!0,g=!1,j;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();f=a.done;return a},e:function e(a){g=!0;j=a},f:function f(){try{if(!f&&null!=c.return)c.return()}finally{if(g)throw j}}}}function h(a,b){if(!a)return;if("string"==typeof a)return i(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return i(a,b)}function i(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}var j=function(a){var b={};a.forEach(function(a){var c=a.id;try{var d=c.split("_")[0];if(!(d in b)){b[d]={data:[],id:d}}b[d].data.push(a)}catch(c){if(!("default"in b)){b["default"]={data:[]}}b["default"].data.push(a)}});for(var l in b){var c=0,d=1,e=0,f=0,h=g(b[l].data),i;try{for(h.s();!(i=h.n()).done;){var j=i.value,k=j.correct/j.total;if(k>c){c=k}if(k<d){d=k}f+=j.total;e+=k}}catch(a){h.e(a)}finally{h.f()}var m=e/b[l].data.length;b[l].statistics={answers:f,average:m}}return b},k=function(a,d){var e="";if("description"in a){e=""===a.description.trim()?a.id:a.description}else{e=a.id}var f={y0:"   ",x:a.percentages,span:[0,1],spanmode:"manual",meanline:{visible:!0},points:"all",pointpos:0,box:{visible:!0},jitter:0,scalemode:"count",type:"violin",orientation:"h"},g={yaxis:{zeroline:!1},violinmode:"overlay"},h={id:a.id,title:e,answers:a.total};c.default.renderForPromise("scormreport_heatmap/plotlysection",h).then(function(b){var e=b.html,h=b.js;c.default.appendNodeContents(d,e,h);window.Plotly.newPlot("scormreport_heatmap_section_"+a.id,[f],g);return!0}).catch(function(a){return(0,b.exception)(a)})},l=function(a,d){var e="";if("description"in a){e=""===a.description.trim()?a.id:a.description}else{e=a.id}var f=a.correct,g=a.total,h=Math.max(Math.min(100,Math.round(100*f/g)),0),i={id:a.id,title:e,answers:a.total,percentage:h,correct:f,total:g};c.default.renderForPromise("scormreport_heatmap/plotlysection",i).then(function(a){var b=a.html,e=a.js;c.default.appendNodeContents(d,b,e);return!0}).catch(function(a){return(0,b.exception)(a)})},m=function(a,b){if("spectrum"===a.displaytype&&0<a.percentages.length){var c=a.percentages[0],d=1===c||0===c;if(d){var e=g(a.percentages),f;try{for(e.s();!(f=e.n()).done;){var h=f.value;if(c!==h){d=!1;break}}}catch(a){e.e(a)}finally{e.f()}}}if("spectrum"===a.displaytype&&!d){k(a,"#".concat(b,"_hiddencontent"))}else{l(a,"#".concat(b,"_hiddencontent"))}},n=function(a,b){var c=0,d=g(b),e;try{for(d.s();!(e=d.n()).done;){var j=e.value;if(j>=a){c++}}}catch(a){d.e(a)}finally{d.f()}var f=100*c/b.length;f=Math.max(0,Math.min(Math.round(f),100));var h=$("#scormreport_heatmap_passingcontainer > .c100");h.removeClass(function(a,b){return b.match("p[0-9]{1,3}")});h.addClass("p".concat(f));var i=$("#scormreport_heatmap_passingcontainer > .c100 > .percentagecircledefaulttext");i.text("".concat(f,"%"))},o=function(a){$("#scormreport_heatmap_settings").click(function(){d.default.create({type:e.default.TYPE}).then(function(b){b.savepressedcallback=function(){var c=parseFloat($("#inputpercentage").val());if(isNaN(c)){return}n(c,a);b.hide()};b.show();return!0}).catch(function(a){return(0,b.exception)(a)})});n(50,a)};a.init=function init(a,d){o(d);var e=j(a),f=function(a){var d=e[a],f="scormreport_heatmap_".concat(a),h={id_prefix:f,title:a,answers:d.statistics.answers,average:(100*d.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",h).then(function(a){var b=a.html,e=a.js;c.default.appendNodeContents("#scormreport_heatmap_container",b,e);var h=g(d.data),i;try{for(h.s();!(i=h.n()).done;){var j=i.value;m(j,f)}}catch(a){h.e(a)}finally{h.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var h in e){f(h)}};a.oneinallchart=function oneinallchart(a){var b=[];a.forEach(function(a){var c={text:a.id,span:[0,1],spanmode:"manual",meanline:{visible:!0},points:"all",pointpos:0,box:{visible:!0},jitter:0,scalemmode:"count",showlegend:!0,type:"violin",name:a.id,y0:a.id,x:a.percentages,orientation:"h"};b.push(c)});var c={title:"Auswertung SCORM",yaxis:{zeroline:!1},violinmode:"overlay"},d=setInterval(function(){if($(".chartjs-render-monitor").length){clearInterval(d);200*a.length;window.Plotly.newPlot($(".chart-area")[0].id,b,c);$(".chart-image")[0].remove()}},100)}});
//# sourceMappingURL=report_view.min.js.map
