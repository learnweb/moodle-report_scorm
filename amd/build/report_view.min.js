define("scormreport_question/report_view",["exports","core/notification","core/templates","jquery"],(function(_exports,_notification,_templates,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);var add_question=function(questiondata,idprefix,editor){var onlyboolvals=!1;if("manual_scored"===questiondata.displaytype&&questiondata.percentages.length>0){onlyboolvals=!0;var _step4,_iterator4=_createForOfIteratorHelper(questiondata.percentages);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var percentage=_step4.value;if(0!==percentage&&1!==percentage){onlyboolvals=!1;break}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}}var appendidentifier="#".concat(idprefix,"_hiddencontent");"result_scored"===questiondata.displaytype||onlyboolvals?function(questiondata,appendidentifier,editor){var questiontext=get_title_from_questiondata(questiondata,editor),correct=questiondata.correct_answers,total=questiondata.total_answers,percentage=100*correct/total,displaypercentage=Math.max(Math.min(100,Math.round(percentage)),0),context={id:questiondata.id,title:questiontext,answers:questiondata.total_answers,percentage:displaypercentage,correct:correct,total:total};_templates.default.renderForPromise("scormreport_question/scoredbinarysection",context).then((function(_ref5){var html=_ref5.html,js=_ref5.js;return _templates.default.appendNodeContents(appendidentifier,html,js),!0})).catch((function(ex){return(0,_notification.exception)(ex)}))}(questiondata,appendidentifier,editor):"manual_scored"===questiondata.displaytype?function(questiondata,appendidentifier,editor){var questiontext=get_title_from_questiondata(questiondata,editor),singletrace={y0:" ",x:questiondata.percentages,span:[0,1],spanmode:"manual",meanline:{visible:!0},points:"all",pointpos:0,box:{visible:!0},jitter:0,scalemode:"count",type:"violin",orientation:"h"},layout={yaxis:{zeroline:!1},xaxis:{range:[0,1],tickformat:",.0%"},violinmode:"overlay"},context={id:questiondata.id,title:questiontext,answers:(null==questiondata?void 0:questiondata.total_answers)||0};_templates.default.renderForPromise("scormreport_question/plotlysection",context).then((function(_ref4){var html=_ref4.html,js=_ref4.js;return _templates.default.appendNodeContents(appendidentifier,html,js),window.Plotly.newPlot("scormreport_question_section_"+questiondata.id,[singletrace],layout),!0})).catch((function(ex){return(0,_notification.exception)(ex)}))}(questiondata,appendidentifier,editor):"numeric_unscored"===questiondata.displaytype?function(questiondata,appendidentifier,editor){var _step2,questiontext=get_title_from_questiondata(questiondata,editor),countscores={},_iterator2=_createForOfIteratorHelper(questiondata.learner_responses);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _step3,_iterator3=_createForOfIteratorHelper(_step2.value);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var score=_step3.value;(score=parseFloat(score))in countscores||(countscores[score]=0),countscores[score]=countscores[score]+1}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}for(var scorelevels=Object.keys(countscores),scoremax=Math.max.apply(Math,scorelevels),x=[],y=[],i=Math.min.apply(Math,scorelevels);i<=scoremax;i++)x.push(i),y.push(i in scorelevels?countscores[i]:0);var data=[{x:x,y:y,type:"bar"}],context={id:questiondata.id,title:questiontext,answers:(null==questiondata?void 0:questiondata.total_answers)||0};_templates.default.renderForPromise("scormreport_question/plotlysection",context).then((function(_ref3){var html=_ref3.html,js=_ref3.js;return _templates.default.appendNodeContents(appendidentifier,html,js),window.Plotly.newPlot("scormreport_question_section_"+questiondata.id,data),!0})).catch((function(ex){return(0,_notification.exception)(ex)}))}(questiondata,appendidentifier,editor):"default_unscored"===questiondata.displaytype&&function(questiondata,appendidentifier,editor){var context={title:get_title_from_questiondata(questiondata,editor),id_prefix:"unscored_table_switch_".concat(questiondata.id),answers:(null==questiondata?void 0:questiondata.total_answers)||0,identlevel:1};_templates.default.renderForPromise("scormreport_question/collapsible_topic",context).then((function(_ref){var html=_ref.html,js=_ref.js;_templates.default.appendNodeContents(appendidentifier,html,js);var context={lines:(null==questiondata?void 0:questiondata.learner_responses)||[],id:questiondata.id};return _templates.default.renderForPromise("scormreport_question/unscoreddefaulttable",context).then((function(_ref2){var html=_ref2.html;return(0,_jquery.default)("#unscored_table_switch_".concat(questiondata.id,"_hiddencontent")).html(html),!0})).catch((function(ex){return(0,_notification.exception)(ex)})),!0})).catch((function(ex){return(0,_notification.exception)(ex)}))}(questiondata,appendidentifier,editor)},_editorcallbacks={articulate:function(questiondata){return""!==questiondata.description?questiondata.description.trim():questiondata.id},ispring:function(questiondata){var _questiondata$id$matc,_questiondata$id$matc2;return(null===(_questiondata$id$matc=questiondata.id.match(/Slide\d+_Q_[^_]*_(?:\d*_)?_?((?:(?<!____).)*)/))||void 0===_questiondata$id$matc||null===(_questiondata$id$matc2=_questiondata$id$matc[1])||void 0===_questiondata$id$matc2?void 0:_questiondata$id$matc2.replaceAll("_"," "))||get_title_for_editor.default(questiondata)},default:function(questiondata){return questiondata.id}},get_title_from_questiondata=function(questiondata){var editor=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";return(null==_editorcallbacks?void 0:_editorcallbacks[editor](questiondata))||_editorcallbacks.default(questiondata)};_exports.init=function(questiondata){var scormdata,predicted_editor,sections=function(scormdata){var scormchartdata={},_loop=function(scoid){var _scormdata$scoid;scormchartdata[scoid]={};var scodata=(null===(_scormdata$scoid=scormdata[scoid])||void 0===_scormdata$scoid?void 0:_scormdata$scoid.questions)||{},scotitle=scormdata[scoid].title,groups={};for(var key in Object.values(scodata).forEach((function(questiondata){var id=questiondata.id;try{var groupname=id.split("_")[0];groupname in groups||(groups[groupname]={data:[],id:groupname}),groups[groupname].data.push(questiondata)}catch(e){"default"in groups||(groups.default={data:[],id:"default"}),groups.default.data.push(questiondata)}})),groups){var _step,best=0,worst=1,sum=0,answersum=0,_iterator=_createForOfIteratorHelper(groups[key].data);try{for(_iterator.s();!(_step=_iterator.n()).done;){var question=_step.value,percentage=question.correct_answers/question.total_answers;percentage>best&&(best=percentage),percentage<worst&&(worst=percentage),answersum+=question.total_answers,sum+=percentage}}catch(err){_iterator.e(err)}finally{_iterator.f()}var average=sum/groups[key].data.length;groups[key].statistics={answers:answersum,average:average}}scormchartdata[scoid].groups=groups,scormchartdata[scoid].title=scotitle};for(var scoid in scormdata)_loop(scoid);return scormchartdata}(questiondata),editor=function(scormdata){for(var _i=0,_Object$values=Object.values(scormdata);_i<_Object$values.length;_i++)for(var sco=_Object$values[_i],_i2=0,_Object$values2=Object.values(sco.questions);_i2<_Object$values2.length;_i2++){var _question$id$match,question=_Object$values2[_i2];if(""!==question.description)return"articulate";if(null!==(_question$id$match=question.id.match(/Slide\d+_Q_[^_]*_(?:\d*_)?_?((?<!__).*)/))&&void 0!==_question$id$match&&_question$id$match.length)return"ispring"}return"default"}(questiondata);if(1===Object.keys(sections).length){sections=sections[Object.keys(sections)[0]];var _loop2=function(section){var sectiondata=sections.groups[section],idprefix="scormreport_question_".concat(section),context={id_prefix:idprefix,title:section,answers:sectiondata.statistics.answers,average:(100*sectiondata.statistics.average).toFixed(2)};_templates.default.renderForPromise("scormreport_question/collapsible_topic",context).then((function(_ref6){var html=_ref6.html,js=_ref6.js;_templates.default.appendNodeContents("#scormreport_question_container",html,js);var _step5,_iterator5=_createForOfIteratorHelper(sectiondata.data);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _questiondata=_step5.value;add_question(_questiondata,idprefix,editor)}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return!0})).catch((function(ex){return(0,_notification.exception)(ex)}))};for(var section in sections.groups)_loop2(section)}else for(var _loop3=function(){var scoid=_Object$keys[_i5],scodata=sections[scoid],context={id_prefix:"scormreport_question_scosection".concat(scoid),title:"".concat(scodata.title)};_templates.default.renderForPromise("scormreport_question/collapsible_topic",context).then((function(_ref7){var html=_ref7.html,js=_ref7.js;_templates.default.appendNodeContents("#scormreport_question_container",html,js);var _loop4=function(_section){var sectiondata=scodata.groups[_section],idprefix="scormreport_question_".concat(_section),context={id_prefix:idprefix,title:_section,answers:sectiondata.statistics.answers,average:(100*sectiondata.statistics.average).toFixed(2)};_templates.default.renderForPromise("scormreport_question/collapsible_topic",context).then((function(_ref8){var html=_ref8.html,js=_ref8.js;_templates.default.appendNodeContents("#scormreport_question_scosection".concat(scoid,"_hiddencontent"),html,js);var _step6,_iterator6=_createForOfIteratorHelper(sectiondata.data);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _questiondata2=_step6.value;add_question(_questiondata2,idprefix,editor)}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}return!0})).catch((function(ex){return(0,_notification.exception)(ex)}))};for(var _section in scodata.groups)_loop4(_section)})).catch((function(ex){return(0,_notification.exception)(ex)}))},_i5=0,_Object$keys=Object.keys(sections);_i5<_Object$keys.length;_i5++)_loop3();scormdata=questiondata,predicted_editor=editor,(0,_jquery.default)("#scormreport_question_choose_editor").val(predicted_editor),(0,_jquery.default)("#scormreport_question_choose_editor").change((function(){for(var editor=(0,_jquery.default)("#scormreport_question_choose_editor").val().toLowerCase(),_i3=0,_Object$values3=Object.values(scormdata);_i3<_Object$values3.length;_i3++)for(var sco=_Object$values3[_i3],_i4=0,_Object$values4=Object.values(sco.questions);_i4<_Object$values4.length;_i4++){var question=_Object$values4[_i4];(0,_jquery.default)("#scormreport_question_sectionwrapper_".concat(question.id," > div > h2")).text(get_title_from_questiondata(question,editor)),(0,_jquery.default)("label[for=unscored_table_switch_".concat(question.id,"_switch]")).text(get_title_from_questiondata(question,editor))}return 0}))}}));

//# sourceMappingURL=report_view.min.js.map