define ("scormreport_heatmap/report_view",["exports","core/notification","core/templates","jquery"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a){return i(a)||h(a)||k(a)||g()}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function i(a){if(Array.isArray(a))return l(a)}function j(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=k(a))||b&&a&&"number"==typeof a.length){if(c)a=c;var d=0,e=function(){};return{s:e,n:function n(){if(d>=a.length)return{done:!0};return{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=!0,g=!1,h;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();f=a.done;return a},e:function e(a){g=!0;h=a},f:function f(){try{if(!f&&null!=c.return)c.return()}finally{if(g)throw h}}}}function k(a,b){if(!a)return;if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(a);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}function l(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}var m=function(a){var b={},c=function(c){b[c]={};var d=a[c].questions,e=a[c].title,f={};Object.values(d).forEach(function(a){var b=a.id;try{var c=b.split("_")[0];if(!(c in f)){f[c]={data:[],id:c}}f[c].data.push(a)}catch(b){if(!("default"in f)){f["default"]={data:[],id:"default"}}f["default"].data.push(a)}});for(var p in f){var g=0,h=1,i=0,k=0,l=j(f[p].data),m;try{for(l.s();!(m=l.n()).done;){var n=m.value,o=n.correct_answers/n.total_answers;if(o>g){g=o}if(o<h){h=o}k+=n.total_answers;i+=o}}catch(a){l.e(a)}finally{l.f()}var q=i/f[p].data.length;f[p].statistics={answers:k,average:q}}b[c].groups=f;b[c].title=e};for(var d in a){c(d)}return b},n=function(a,e,f){var g=t[f](a),h={title:g,id_prefix:"unscored_table_switch_".concat(a.id),answers:a.total_answers,identlevel:1};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",h).then(function(f){var g=f.html,h=f.js;c.default.appendNodeContents(e,g,h);var i={lines:a.learner_responses,id:a.id};c.default.renderForPromise("scormreport_heatmap/unscored_default_table",i).then(function(b){var c=b.html;(0,d.default)("#unscored_table_switch_".concat(a.id,"_hiddencontent")).html(c);return!0}).catch(function(a){return(0,b.exception)(a)});return!0}).catch(function(a){return(0,b.exception)(a)})},o=function(a,d,e){var g=t[e](a),h={},k=j(a.learner_responses),l;try{for(k.s();!(l=k.n()).done;){var m=l.value,n=j(m),o;try{for(n.s();!(o=n.n()).done;){var y=o.value;y=parseFloat(y);if(!(y in h)){h[y]=0}h[y]=h[y]+1}}catch(a){n.e(a)}finally{n.f()}}}catch(a){k.e(a)}finally{k.f()}for(var p=Object.keys(h),q=Math.max.apply(Math,f(p)),r=Math.min.apply(Math,f(p)),s=[],u=[],v=r;v<=q;v++){s.push(v);u.push(v in p?h[v]:0)}var w=[{x:s,y:u,type:"bar"}],x={id:a.id,title:g,answers:a.total_answers};c.default.renderForPromise("scormreport_heatmap/plotlysection",x).then(function(b){var e=b.html,f=b.js;c.default.appendNodeContents(d,e,f);window.Plotly.newPlot("scormreport_heatmap_section_"+a.id,w);return!0}).catch(function(a){return(0,b.exception)(a)})},p=function(a,d,e){var f=t[e](a),g={y0:" ",x:a.percentages,span:[0,1],spanmode:"manual",meanline:{visible:!0},points:"all",pointpos:0,box:{visible:!0},jitter:0,scalemode:"count",type:"violin",orientation:"h"},h={yaxis:{zeroline:!1},xaxis:{range:[0,1],tickformat:",.0%"},violinmode:"overlay"},i={id:a.id,title:f,answers:a.total_answers};c.default.renderForPromise("scormreport_heatmap/plotlysection",i).then(function(b){var e=b.html,f=b.js;c.default.appendNodeContents(d,e,f);window.Plotly.newPlot("scormreport_heatmap_section_"+a.id,[g],h);return!0}).catch(function(a){return(0,b.exception)(a)})},q=function(a,d,e){var f=t[e](a),g=a.correct_answers,h=a.total_answers,i=Math.max(Math.min(100,Math.round(100*g/h)),0),j={id:a.id,title:f,answers:a.total_answers,percentage:i,correct:g,total:h};c.default.renderForPromise("scormreport_heatmap/scored_binary_section",j).then(function(a){var b=a.html,e=a.js;c.default.appendNodeContents(d,b,e);return!0}).catch(function(a){return(0,b.exception)(a)})},r=function(a,b,c){var d=!1;if("manual_scored"===a.displaytype&&0<a.percentages.length){d=!0;var e=j(a.percentages),f;try{for(e.s();!(f=e.n()).done;){var h=f.value;if(0!==h&&1!==h){d=!1;break}}}catch(a){e.e(a)}finally{e.f()}}var g="#".concat(b,"_hiddencontent");if("result_scored"===a.displaytype||d){q(a,g,c)}else if("manual_scored"===a.displaytype){p(a,g,c)}else if("numeric_unscored"===a.displaytype){o(a,g,c)}else if("default_unscored"===a.displaytype){n(a,g,c)}},s=function(a){for(var b=0,c=Object.values(a),d;b<c.length;b++){d=c[b];for(var e=0,f=Object.values(d.questions);e<f.length;e++){var g,h=f[e];if(""!==h.description){return"articulate"}else if((null===(g=h.id.match(/Slide\d+_Q_[^_]*_(?:\d*_)?_?((?<!__).*)/))||void 0===g?void 0:g.length)||!1){return"ispringz"}}}return"default"},t={articulate:function articulate(a){return""!==a.description?a.description.trim():a.id},ispringz:function ispringz(a){var b,c;return(null===(b=a.id.match(/Slide\d+_Q_[^_]*_(?:\d*_)?_?((?<!__).*)/))||void 0===b?void 0:null===(c=b[1])||void 0===c?void 0:c.replaceAll("_"," "))||t["default"](a)},default:function _default(a){return a.id}},u=function(a,b){(0,d.default)("#scormreport_heatmap_choose_editor").val(b);(0,d.default)("#scormreport_heatmap_choose_editor").change(function(){var b=(0,d.default)("#scormreport_heatmap_choose_editor").val().toLowerCase();if(!(b in t)){b="default"}for(var c=0,e=Object.values(a),f;c<e.length;c++){f=e[c];for(var g=0,h=Object.values(f.questions),i;g<h.length;g++){i=h[g];(0,d.default)("#scormreport_heatmap_sectionwrapper_".concat(i.id," > div > h2")).text(t[b](i));(0,d.default)("label[for=unscored_table_switch_".concat(i.id,"_switch]")).text(t[b](i))}}return 0})};a.init=function init(a){var d=m(a),e=s(a);window.console.log("predicting "+e);if(1===Object.keys(d).length){d=d[Object.keys(d)[0]];var f=function(a){var f=d.groups[a],g="scormreport_heatmap_".concat(a),h={id_prefix:g,title:a,answers:f.statistics.answers,average:(100*f.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",h).then(function(a){var b=a.html,d=a.js;c.default.appendNodeContents("#scormreport_heatmap_container",b,d);var h=j(f.data),i;try{for(h.s();!(i=h.n()).done;){var k=i.value;r(k,g,e)}}catch(a){h.e(a)}finally{h.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var k in d.groups){f(k)}}else{for(var g=function(){var a=i[h],f=d[a],g={id_prefix:"scormreport_heatmap_scosection".concat(a),title:"".concat(f.title)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",g).then(function(d){var g=d.html,h=d.js;c.default.appendNodeContents("#scormreport_heatmap_container",g,h);var i=function(d){var g=f.groups[d],h="scormreport_heatmap_".concat(d),i={id_prefix:h,title:d,answers:g.statistics.answers,average:(100*g.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_heatmap/collapsible_topic",i).then(function(b){var d=b.html,f=b.js;c.default.appendNodeContents("#scormreport_heatmap_scosection".concat(a,"_hiddencontent"),d,f);var i=j(g.data),k;try{for(i.s();!(k=i.n()).done;){var l=k.value;r(l,h,e)}}catch(a){i.e(a)}finally{i.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var k in f.groups){i(k)}}).catch(function(a){return(0,b.exception)(a)})},h=0,i=Object.keys(d);h<i.length;h++){g()}}u(a,e)}});
//# sourceMappingURL=report_view.min.js.map
