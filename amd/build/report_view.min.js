define ("scormreport_question/report_view",["exports","core/notification","core/templates","jquery"],function(a,b,c,d){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=e(c);d=e(d);function e(a){return a&&a.__esModule?a:{default:a}}function f(a){return i(a)||h(a)||k(a)||g()}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function i(a){if(Array.isArray(a))return l(a)}function j(a){if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(a=k(a))){var b=0,c=function(){};return{s:c,n:function n(){if(b>=a.length)return{done:!0};return{done:!1,value:a[b++]}},e:function e(a){throw a},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var d,e=!0,f=!1,g;return{s:function s(){d=a[Symbol.iterator]()},n:function n(){var a=d.next();e=a.done;return a},e:function e(a){f=!0;g=a},f:function f(){try{if(!e&&null!=d.return)d.return()}finally{if(f)throw g}}}}function k(a,b){if(!a)return;if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}function l(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}var m=function(a){var b={},c=function(c){var d;b[c]={};var e=(null===(d=a[c])||void 0===d?void 0:d.questions)||{},f=a[c].title,g={};Object.values(e).forEach(function(a){var b=a.id;try{var c=b.split("_")[0];if(!(c in g)){g[c]={data:[],id:c}}g[c].data.push(a)}catch(b){if(!("default"in g)){g["default"]={data:[],id:"default"}}g["default"].data.push(a)}});for(var q in g){var h=0,i=1,k=0,l=0,m=j(g[q].data),n;try{for(m.s();!(n=m.n()).done;){var o=n.value,p=o.correct_answers/o.total_answers;if(p>h){h=p}if(p<i){i=p}l+=o.total_answers;k+=p}}catch(a){m.e(a)}finally{m.f()}var r=k/g[q].data.length;g[q].statistics={answers:l,average:r}}b[c].groups=g;b[c].title=f};for(var d in a){c(d)}return b},n=function(a,e,f){var g=u(a,f),h={title:g,id_prefix:"unscored_table_switch_".concat(a.id),answers:(null===a||void 0===a?void 0:a.total_answers)||0,identlevel:1};c.default.renderForPromise("scormreport_question/collapsible_topic",h).then(function(f){var g=f.html,h=f.js;c.default.appendNodeContents(e,g,h);var i={lines:(null===a||void 0===a?void 0:a.learner_responses)||[],id:a.id};c.default.renderForPromise("scormreport_question/unscoreddefaulttable",i).then(function(b){var c=b.html;(0,d.default)("#unscored_table_switch_".concat(a.id,"_hiddencontent")).html(c);return!0}).catch(function(a){return(0,b.exception)(a)});return!0}).catch(function(a){return(0,b.exception)(a)})},o=function(a,d,e){var g=u(a,e),h={},k=j(a.learner_responses),l;try{for(k.s();!(l=k.n()).done;){var m=l.value,n=j(m),o;try{for(n.s();!(o=n.n()).done;){var y=o.value;y=parseFloat(y);if(!(y in h)){h[y]=0}h[y]=h[y]+1}}catch(a){n.e(a)}finally{n.f()}}}catch(a){k.e(a)}finally{k.f()}for(var p=Object.keys(h),q=Math.max.apply(Math,f(p)),r=Math.min.apply(Math,f(p)),s=[],t=[],v=r;v<=q;v++){s.push(v);t.push(v in p?h[v]:0)}var w=[{x:s,y:t,type:"bar"}],x={id:a.id,title:g,answers:(null===a||void 0===a?void 0:a.total_answers)||0};c.default.renderForPromise("scormreport_question/plotlysection",x).then(function(b){var e=b.html,f=b.js;c.default.appendNodeContents(d,e,f);window.Plotly.newPlot("scormreport_question_section_"+a.id,w);return!0}).catch(function(a){return(0,b.exception)(a)})},p=function(a,d,e){var f=u(a,e),g={y0:" ",x:a.percentages,span:[0,1],spanmode:"manual",meanline:{visible:!0},points:"all",pointpos:0,box:{visible:!0},jitter:0,scalemode:"count",type:"violin",orientation:"h"},h={yaxis:{zeroline:!1},xaxis:{range:[0,1],tickformat:",.0%"},violinmode:"overlay"},i={id:a.id,title:f,answers:(null===a||void 0===a?void 0:a.total_answers)||0};c.default.renderForPromise("scormreport_question/plotlysection",i).then(function(b){var e=b.html,f=b.js;c.default.appendNodeContents(d,e,f);window.Plotly.newPlot("scormreport_question_section_"+a.id,[g],h);return!0}).catch(function(a){return(0,b.exception)(a)})},q=function(a,d,e){var f=u(a,e),g=a.correct_answers,h=a.total_answers,i=Math.max(Math.min(100,Math.round(100*g/h)),0),j={id:a.id,title:f,answers:a.total_answers,percentage:i,correct:g,total:h};c.default.renderForPromise("scormreport_question/scoredbinarysection",j).then(function(a){var b=a.html,e=a.js;c.default.appendNodeContents(d,b,e);return!0}).catch(function(a){return(0,b.exception)(a)})},r=function(a,b,c){var d=!1;if("manual_scored"===a.displaytype&&0<a.percentages.length){d=!0;var e=j(a.percentages),f;try{for(e.s();!(f=e.n()).done;){var h=f.value;if(0!==h&&1!==h){d=!1;break}}}catch(a){e.e(a)}finally{e.f()}}var g="#".concat(b,"_hiddencontent");if("result_scored"===a.displaytype||d){q(a,g,c)}else if("manual_scored"===a.displaytype){p(a,g,c)}else if("numeric_unscored"===a.displaytype){o(a,g,c)}else if("default_unscored"===a.displaytype){n(a,g,c)}},s=function(a){for(var b=0,c=Object.values(a),d;b<c.length;b++){d=c[b];for(var e=0,f=Object.values(d.questions);e<f.length;e++){var g,h=f[e];if(""!==h.description){return"articulate"}else if((null===(g=h.id.match(/Slide\d+_Q_[^_]*_(?:\d*_)?_?((?<!__).*)/))||void 0===g?void 0:g.length)||!1){return"ispring"}}}return"default"},t={articulate:function articulate(a){return""!==a.description?a.description.trim():a.id},ispring:function ispring(a){var b,c;return(null===(b=a.id.match(/Slide\d+_Q_[^_]*_(?:\d*_)?_?((?:(?<!____).)*)/))||void 0===b?void 0:null===(c=b[1])||void 0===c?void 0:c.replaceAll("_"," "))||get_title_for_editor["default"](a)},default:function _default(a){return a.id}},u=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"default";return(null===t||void 0===t?void 0:t[b](a))||t["default"](a)},v=function(a,b){(0,d.default)("#scormreport_question_choose_editor").val(b);(0,d.default)("#scormreport_question_choose_editor").change(function(){for(var b=(0,d.default)("#scormreport_question_choose_editor").val().toLowerCase(),c=0,e=Object.values(a),f;c<e.length;c++){f=e[c];for(var g=0,h=Object.values(f.questions),i;g<h.length;g++){i=h[g];(0,d.default)("#scormreport_question_sectionwrapper_".concat(i.id," > div > h2")).text(u(i,b));(0,d.default)("label[for=unscored_table_switch_".concat(i.id,"_switch]")).text(u(i,b))}}return 0})};a.init=function init(a){var d=m(a),e=s(a);if(1===Object.keys(d).length){d=d[Object.keys(d)[0]];var f=function(a){var f=d.groups[a],g="scormreport_question_".concat(a),h={id_prefix:g,title:a,answers:f.statistics.answers,average:(100*f.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_question/collapsible_topic",h).then(function(a){var b=a.html,d=a.js;c.default.appendNodeContents("#scormreport_question_container",b,d);var h=j(f.data),i;try{for(h.s();!(i=h.n()).done;){var k=i.value;r(k,g,e)}}catch(a){h.e(a)}finally{h.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var k in d.groups){f(k)}}else{for(var g=function(){var a=i[h],f=d[a],g={id_prefix:"scormreport_question_scosection".concat(a),title:"".concat(f.title)};c.default.renderForPromise("scormreport_question/collapsible_topic",g).then(function(d){var g=d.html,h=d.js;c.default.appendNodeContents("#scormreport_question_container",g,h);var i=function(d){var g=f.groups[d],h="scormreport_question_".concat(d),i={id_prefix:h,title:d,answers:g.statistics.answers,average:(100*g.statistics.average).toFixed(2)};c.default.renderForPromise("scormreport_question/collapsible_topic",i).then(function(b){var d=b.html,f=b.js;c.default.appendNodeContents("#scormreport_question_scosection".concat(a,"_hiddencontent"),d,f);var i=j(g.data),k;try{for(i.s();!(k=i.n()).done;){var l=k.value;r(l,h,e)}}catch(a){i.e(a)}finally{i.f()}return!0}).catch(function(a){return(0,b.exception)(a)})};for(var k in f.groups){i(k)}}).catch(function(a){return(0,b.exception)(a)})},h=0,i=Object.keys(d);h<i.length;h++){g()}}v(a,e)}});
//# sourceMappingURL=report_view.min.js.map
